<script src="../../build/bundle.js"></script>

<canvas id="canvas" width="400" height="400"/>

<script>


    // Create a custom system to process the compoentns
    class CanvasSystem extends cx.cxVoidSystem {
        static get tag() {
            return 'fabs.system.canvas'
        }

        constructor() {
            super();
            this.canvas = document.getElementById('canvas');
            this.ctx = this.canvas.getContext('2d');
        }

        update() {
        }
    }

    // Create a custom system to process the compoentns
    class CanvasDrawSystem extends cx.cxEntitySystem {
        static get tag() {
            return 'fabs.system.canvasdraw'
        }

        constructor() {
            super();
            this.components = [SquareComponent.tag];
        }

        addedToWorld() {
            this.canvaSystem = this.world.getSystem(CanvasSystem.tag);
        }

        update(entitiy) {
            const components = entity.getComponents(SquareComponent.tag);
            for (let i = 0; i < components.length; i++) {
                this.canvaSystem.ctx.fillRect(components[i].x, components[i].y, components[i].w, components[i].h)
            }
        }
    }

    /**
     * Create component that holds your data
     */
    class SquareComponent extends cx.cxComponent {
        static get tag() {
            return 'fabs.component.square'
        }

        constructor(width, height) {
            super();
            this.x = 0;
            this.y = 0;
            this.width = width;
            this.height = height;
        }
    }

    // create custom scene
    class MyScene extends cx.cxScene {
        constructor() {
            super("MainScene");
        }

        // Create everything that is required for this scene to be rendered.
        // Add systems and entities
        load() {
            this.world.addSystem(new CanvasSystem());
            this.world.addSystem(new CanvasDrawSystem());
            this.createPointer();
        }

        createPointer() {
            let pointer = new cx.cxEntity("Pointer");
            pointer.addComponent(new SquareComponent(20, 20));
            this.world.addEntity(pointer);
        }
    }

    const complex = cx.Complex.getInstance();

    // Load the scene you wan't to render
    complex.loadScene(new MyScene());

    // Render it
    function render() {
        complex.update();
        requestAnimationFrame(render);
    }

    requestAnimationFrame(render);

</script>
