"use strict";var cx={version:"0.9.4",initFunctions:[],addInitFunction:function(a){cx.initFunctions.push(a)},init:function(){for(var b=0,a=cx.initFunctions.length;b<a;b++){cx.initFunctions[b]()}},loop:{update:function(){},init:function(){window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(b){window.setTimeout(b,1000/60)}})();(function a(){requestAnimFrame(a);cx.loop.update()})()}}};console.log("Complex "+cx.version);var GameObject=function(){this.tag=null;this.debugable=true};cx.GameObject=GameObject;var Component=function(){cx.GameObject.call(this)};Component.prototype=Object.create(cx.GameObject.prototype);Component.prototype.constructor=Component;cx.Component=Component;var Entity=function(){cx.GameObject.call(this);this.components=[];this.alive=true;this.remove=false};Entity.prototype=Object.create(cx.GameObject.prototype);Entity.prototype.constructor=Entity;Entity.prototype.getWorld=function(){return this.world};Entity.prototype.setWorld=function(a){this.world=a};Entity.prototype.addComponent=function(a){var b=this._getFreeSlot();if(b!=null){this.components[b]=a}else{this.components.push(a)}};Entity.prototype.getComponent=function(b){for(var d=0,a=this.components.length;d<a;d++){var c=this.components[d];if(c.tag==b){return c}}return null};Entity.prototype.removeComponent=function(b){for(var d=0,a=this.components.length;d<a;d++){var c=this.components[d];if(c.tag==b){delete this.components[d]}}};Entity.prototype.getComponents=function(){return this.components};Entity.prototype._getFreeSlot=function(){for(var d=0,a=this.components.length;d<a;d++){var b=this.components[d];if(b==undefined||b==null){return d}}return null};Entity.prototype.destroy=function(){this.alive=false;this.remove=true},cx.Entity=Entity;var System=function(){cx.GameObject.call(this);this.world=null;this.tag=null};System.TYPE_VOID="void";System.TYPE_PROCESS="process";System.prototype=Object.create(cx.GameObject.prototype);System.prototype.constructor=System;System.prototype.addedToWorld=function(){};System.prototype.added=function(a){};System.prototype.removed=function(a){};System.prototype.setWorld=function(a){this.world=a};System.prototype.getWorld=function(){return this.world};cx.System=System;var EntitySystem=function(){cx.System.call(this);this.components=[];this.type=cx.System.TYPE_PROCESS};EntitySystem.prototype=Object.create(cx.System.prototype);EntitySystem.prototype.constructor=EntitySystem;EntitySystem.prototype.update=function(a,b){};cx.EntitySystem=EntitySystem;var VoidSystem=function(){cx.System.call(this);this.type=cx.System.TYPE_VOID};VoidSystem.prototype=Object.create(cx.System.prototype);VoidSystem.prototype.consctructor=VoidSystem;VoidSystem.prototype.update=function(){};cx.VoidSystem=VoidSystem;var World=function(){cx.GameObject.call(this);this.entities=[];this.voidSystems=[];this.entitySystems=[];this.managers=[];this.tag="cx.World"};World.prototype=Object.create(cx.GameObject.prototype);World.prototype.constructor=World;World.prototype.addEntity=function(a){var b=this._getFreeEntitySlot();a.setWorld(this);if(b!=null){a.index=b;this.entities[b]=a}else{a.index=this.entities.length;this.entities.push(a)}this._entityAdded(a)};World.prototype.removeEntity=function(a){this._entityDeleted(a);delete this.entities[a.index]};World.prototype.getEntity=function(a){return this.entities[a]};World.prototype.getEntities=function(){var d=[];for(var c=0,a=this.entities.length;c<a;c++){var b=this.entities[c];if(b==undefined||b==null){continue}d.push(b)}return d};World.prototype.addSystem=function(a){a.setWorld(this);if(a.type==cx.System.TYPE_PROCESS){var b=this._getFreeProcessSystemSlot();if(b!=null){this.entitySystems[b]=a}else{this.entitySystems.push(a)}}else{if(a.type==cx.System.TYPE_VOID){var b=this._getFreeProcessSystemSlot();if(b!=null){this.voidSystems[b]=a}else{this.voidSystems.push(a)}}}a.addedToWorld()};World.prototype.getSystem=function(d){var c="";if(typeof d=="string"){c=d}else{c=d.tag}for(var b=0,a=this.entitySystems.length;b<a;b++){var d=this.entitySystems[b];if(d.tag==c){return d}}for(var b=0,a=this.voidSystems.length;b<a;b++){var d=this.voidSystems[b];if(d.tag==c){return d}}return null};World.prototype.getSystems=function(a){if(a=="process"){return this.entitySystems}if(a=="void"){return this.voidSystems}};World.prototype.removeSystem=function(d){var c="";if(typeof d=="string"){c=d}else{c=d.tag}for(var b=0,a=this.entitySystems.length;b<a;b++){var d=this.entitySystems[b];if(d.tag==c){delete this.entitySystems[b]}}for(var b=0,a=this.voidSystems.length;b<a;b++){var d=this.voidSystems[b];if(d.tag==c){delete this.voidSystems[b]}}};World.prototype.addManager=function(a){a.world=this;this.managers.push(a)};World.prototype.getManager=function(b){for(var d=0,a=this.managers.length;d<a;d++){var c=this.managers[d];if(c.tag==b){return this.managers[d]}}return null};World.prototype.update=function(){for(var n=0,i=this.voidSystems.length;n<i;n++){var b=this.voidSystems[n];b.update()}for(var n=0,i=this.entitySystems.length;n<i;n++){var b=this.entitySystems[n];for(var h=0,f=this.entities.length;h<f;h++){var g=this.entities[h];if(g==null){continue}if(!g.alive&&g.remove){this.removeEntity(g);continue}if(!g.alive){continue}var j=[];var k=true;for(var a=0,c=b.components.length;a<c;a++){var d=b.components[a];var m=false;var l=g.getComponent(d);if(l!=null){j[d]=l;m=true}if(!m){k=false}}if(k){b.update(g,j)}}}};World.prototype._getFreeEntitySlot=function(){for(var c=0,a=this.entities.length;c<a;c++){var b=this.entities[c];if(b==null||b==undefined){return c}}return null};World.prototype._getFreeProcessSystemSlot=function(){for(var b=0,a=this.entitySystems.length;b<a;b++){var c=this.entitySystems[b];if(c==undefined||c==null){return b}}return null};World.prototype._getFreeVoidSystemSlot=function(){for(var b=0,a=this.voidSystems.length;b<a;b++){var c=this.voidSystems[b];if(c==undefined||c==null){return b}}return null};World.prototype._entityAdded=function(b){for(var c=0,a=this.voidSystems.length;c<a;c++){var d=this.voidSystems[c];d.added(b)}for(var c=0,a=this.entitySystems.length;c<a;c++){var d=this.entitySystems[c];d.added(b)}};World.prototype._entityDeleted=function(b){for(var c=0,a=this.voidSystems.length;c<a;c++){var d=this.voidSystems[c];d.removed(b)}for(var c=0,a=this.entitySystems.length;c<a;c++){var d=this.entitySystems[c];d.removed(b)}};cx.World=World;var Manager=function(){cx.GameObject.call(this);this.tag=null;this.world=null};Manager.prototype=Object.create(cx.GameObject.prototype);Manager.prototype.constructor=Manager;cx.Manager=Manager;