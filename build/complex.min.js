(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(g){var f=this.prototype;a=true;var e=new this();a=false;for(var d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,i){return function(){var k=this._super;this._super=f[h];var j=i.apply(this,arguments);this._super=k;return j}})(d,g[d]):g[d]}function c(){if(!a&&this.init){this.init.apply(this,arguments)}}c.prototype=e;c.prototype.constructor=c;c.extend=arguments.callee;return c}})();var cx={version:"0.9.1",initFunctions:[],addInitFunction:function(a){cx.initFunctions.push(a)},init:function(){for(var b=0,a=cx.initFunctions.length;b<a;b++){cx.initFunctions[b]()}}};console.log("Complex "+cx.version);cx.Component=Class.extend({tag:null,init:function(){this.debugable=true}});cx.Entity=Class.extend({components:[],world:null,alive:true,init:function(){this.components=[];this.alive=true;this.remove=false},getWorld:function(){return this.world},setWorld:function(a){this.world=a},addComponent:function(a){var b=this._getFreeSlot();if(b!=null){this.components[b]=a}else{this.components.push(a)}},getComponent:function(b){for(var d=0,a=this.components.length;d<a;d++){var c=this.components[d];if(c.tag==b){return c}}return null},getComponents:function(){return this.components},removeComponent:function(b){for(var d=0,a=this.components.length;d<a;d++){var c=this.components[d];if(c.tag==b){delete this.components[d]}}},destroy:function(){this.alive=false;this.remove=true},_getFreeSlot:function(){for(var d=0,a=this.components.length;d<a;d++){var b=this.components[d];if(b==undefined||b==null){return d}}return null}});cx.System=Class.extend({world:null,tag:null,init:function(){this.TYPE_VOID="void";this.TYPE_PROCESS="process";this.debugable=true},addedToWorld:function(){},setWorld:function(a){this.world=a},getWorld:function(){return this.world},});cx.EntitySystem=cx.System.extend({init:function(a){this._super();this.components=a;this.type=this.TYPE_PROCESS},update:function(a,b){}});cx.VoidSystem=cx.System.extend({init:function(){this._super();this.type=this.TYPE_VOID},added:function(a){},removed:function(a){},update:function(){}});cx.World=Class.extend({entities:[],systems:[],voidSystems:[],processSystems:[],managers:[],tag:"cx.World",addEntity:function(a){var b=this._getFreeEntitySlot();a.setWorld(this);if(b!=null){a.index=b;this.entities[b]=a}else{a.index=this.entities.length;this.entities.push(a)}this._entityAdded(a)},removeEntity:function(a,b){b=b||true;if(b){this._entityDeleted(a)}delete this.entities[a.index]},getEntity:function(a){return this.entities[a]},addSystem:function(a){a.setWorld(this);if(a.type==a.TYPE_PROCESS){var b=this._getFreeProcessSystemSlot();if(b!=null){this.processSystems[b]=a}else{this.processSystems.push(a)}}else{if(a.type==a.TYPE_VOID){var b=this._getFreeProcessSystemSlot();if(b!=null){this.voidSystems[b]=a}else{this.voidSystems.push(a)}}}a.addedToWorld()},getSystem:function(d){var c="";if(typeof d=="string"){c=d}else{c=d.tag}for(var b=0,a=this.processSystems.length;b<a;b++){var d=this.processSystems[b];if(d.tag==c){return d}}for(var b=0,a=this.voidSystems.length;b<a;b++){var d=this.voidSystems[b];if(d.tag==c){return d}}return null},removeSystem:function(d){var c="";if(typeof d=="string"){c=d}else{c=d.tag}for(var b=0,a=this.processSystems.length;b<a;b++){var d=this.processSystems[b];if(d.tag==c){delete this.processSystems[b]}}for(var b=0,a=this.voidSystems.length;b<a;b++){var d=this.voidSystems[b];if(d.tag==c){delete this.voidSystems[b]}}},addManager:function(a){a.world=this;this.managers.push(a)},getManager:function(b){for(var d=0,a=this.managers.length;d<a;d++){var c=this.managers[d];if(c.tag==b){return c}}return null},update:function(){for(var n=0,i=this.voidSystems.length;n<i;n++){var b=this.voidSystems[n];b.update()}for(var n=0,i=this.processSystems.length;n<i;n++){var b=this.processSystems[n];for(var h=0,f=this.entities.length;h<f;h++){var g=this.entities[h];if(g.delteted&&g.remove){this.removeEntity(g,false);continue}if(g.remove&&!g.delteted){this._entityDeleted(g);continue}if(!g.alive){continue}var j=[];var k=true;for(var a=0,c=b.components.length;a<c;a++){var d=b.components[a];var m=false;var l=g.getComponent(d);if(l!=null){j[d]=l;m=true}if(!m){k=false}}if(k){b.update(g,j)}}}},_getFreeEntitySlot:function(){for(var c=0,a=this.entities.length;c<a;c++){var b=this.entities[c];if(b==null||b==undefined){return c}}return null},_getFreeProcessSystemSlot:function(){for(var b=0,a=this.processSystems.length;b<a;b++){var c=this.processSystems[b];if(c==undefined||c==null){return b}}return null},_getFreeVoidSystemSlot:function(){for(var b=0,a=this.voidSystems.length;b<a;b++){var c=this.voidSystems[b];if(c==undefined||c==null){return b}}return null},_entityAdded:function(b){for(var c=0,a=this.voidSystems.length;c<a;c++){var d=this.voidSystems[c];d.added(b)}},_entityDeleted:function(b){for(var c=0,a=this.voidSystems.length;c<a;c++){var d=this.voidSystems[c];d.removed(b)}b.delteted=true},});cx.Manager=Class.extend({tag:null,world:null,init:function(){this.debugable=true}});