var Log={d:function(a,c){var b=Log._tag(a);console.log(b,c)},_tag:function(a){if(a.tag){return a.tag}if(typeof a==="string"){return a.toString()}}};var cx={tag:"cx",update:function(){cx.App.update()}};cx.App={engine:null,updater:null,fps:30,data:{},use:function(a){cx.App.ScriptLoader.scripts=a},setEngine:function(a){this.engine=a},getEngine:function(){return this.engine},config:function(a){Log.d("cx","configure");for(entry in a){this[entry]=a[entry]}},load:function(b,a){cx.App.ScriptLoader.load(b,a)},init:function(){Log.d("cx","init");this.setEngine(new cx.Engine());cx.Input.Keyboard.init();cx.Input.Mouse.init();return this.getEngine()},stop:function(){Log.d("cx","stop");clearInterval(cx.App.updater)},loadComplete:function(){Log.d("cx","loadComplete");window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(b){window.setTimeout(b,1000/cx.App.fps)}})();(function a(){requestAnimFrame(a);cx.App.engine.update()})()}};cx.App.ScriptLoader={scripts:[],loadedScripts:0,callback:function(){},scriptLoaded:function(){Log.d("cx","script loaded");cx.App.ScriptLoader.loadedScripts++;if(cx.App.ScriptLoader.loadedScripts>=cx.App.ScriptLoader.scripts.length){cx.App.ScriptLoader.callback()}},load:function(a,e){Log.d("cx","load scripts "+cx.App.ScriptLoader.scripts.length);cx.App.ScriptLoader.callback=e;for(var d=0,c=cx.App.ScriptLoader.scripts.length;d<c;d++){var b=document.createElement("script");b.src=cx.App.ScriptLoader.scripts[d];b.onload=cx.App.ScriptLoader.scriptLoaded;a.appendChild(b)}}};cx.Component=Class.extend({init:function(a){this.name=a;this.tag=this.name}});cx.Engine=Class.extend({init:function(){this.tag="cx.Engine";this.screen=null},update:function(){if(this.screen){this.screen.update()}},setScreen:function(a){if(this.screen){this.screen.hide()}this.screen=a;this.screen.show()}});cx.Entity=Class.extend({components:[],init:function(){this.components=[]},addComponent:function(a){this.components.push(a)},getComponent:function(b){for(var d=0,a=this.components.length;d<a;d++){var c=this.components[d];if(c.name==b){return c}}return null}});cx.Screen=Class.extend({init:function(){this.world=new cx.World();this.tag="cx.Screen"},show:function(){},hide:function(){},postUpdate:function(){},preUpdate:function(){},update:function(){this.preUpdate();this.world.update();this.postUpdate()}});cx.System=Class.extend({components:[],TYPE_VOID:"void",TYPE_PROCESS:"process",type:"process",world:null,init:function(a){this.components=a},setWorld:function(a){this.world=a},getWorld:function(){return this.world},update:function(a,b){}});cx.World=Class.extend({entities:[],systems:[],managers:[],tag:"cx.World",addEntity:function(a){a.index=this.entities.length;this.entities.push(a)},addSystem:function(a){Log.d(this,"add system "+a.tag);a.setWorld(this);this.systems.push(a)},addManager:function(a){Log.d(this,"add manager "+a.tag);this.managers.push(a)},getSystem:function(c){for(var b=0,a=this.systems.length;b<a;b++){var d=this.systems[b];if(d.tag==c){return d}}return null},getManager:function(b){for(var d=0,a=this.managers.length;d<a;d++){var c=this.managers[d];if(c.tag==b){return c}}return null},getEntity:function(a){return this.entities[a]},update:function(){for(var p=0,j=this.systems.length;p<j;p++){var b=this.systems[p];if(b.type==b.TYPE_VOID){b.update()}else{if(b.type==b.TYPE_PROCESS){for(var i=0,f=this.entities.length;i<f;i++){var h=this.entities[i];var k=[];var l=true;for(var a=0,c=b.components.length;a<c;a++){var d=b.components[a];var n=false;for(var o=0,g=h.components.length;o<g;o++){var m=h.components[o];k[m.name]=m;if(m.name==d){n=true}}if(!n){l=false}}if(l){b.update(h,k)}}}}}}});cx.Manager=Class.extend({init:function(a){this.name=a;this.tag=this.name}});cx.Input={};cx.Input.Keyboard={_key:[],init:function(){window.onkeydown=this.onkeydown;window.onkeyup=this.onkeyup},onkeydown:function(a){cx.Input.Keyboard._key[a.which]=true},onkeyup:function(a){cx.Input.Keyboard._key[a.which]=false},isKeyPressed:function(a){var b=a.charCodeAt(0);return cx.Input.Keyboard._key[b]}};cx.Input.Mouse={x:0,y:0,init:function(){window.onmousemove=cx.Input.Mouse.move},move:function(a){cx.Input.Mouse.x=a.clientX;cx.Input.Mouse.y=a.clientY}};